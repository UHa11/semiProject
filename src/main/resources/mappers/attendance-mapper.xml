<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.project.cse.boot.mappers.AttendanceMapper">
    <resultMap id="attendanceMap" type="Attendance">
        <id column="ATTENDANCE_NO" property="attendanceNo"/>
        <result column="WORKING_TIME" property="workingTime"/>
        <result column="WORKOUT_TIME" property="workoutTime"/>

        <association property="member" javaType="Member">
            <id column="M_MEMBER_NO" property="memberNo"/>
            <result column="MEMBER_ID" property="memberId"/>
            <result column="MEMBER_NAME" property="memberName"/>
            <result column="PHONE_NUMBER" property="phone"/>
            <result column="POSITION" property="position"/>
            <result column="MEMBER_STATUS" property="status"/>
        </association>
    </resultMap>

    <select id="selectInfoList" resultMap="attendanceMap">
        SELECT
        A.ATTENDANCE_NO,
        A.WORKING_TIME,
        A.WORKOUT_TIME,
        M.MEMBER_NO AS M_MEMBER_NO,
        M.MEMBER_ID,
        M.MEMBER_NAME,
        M.PHONE_NUMBER,
        M.POSITION,
        M.MEMBER_STATUS
        FROM ATTENDANCE A
        JOIN MEMBER M ON A.MEMBER_NO = M.MEMBER_NO
    </select>

    <update id="updateWorkTime" parameterType="attendance">
        UPDATE ATTENDANCE
        <set>
            <if test="workingTime != null">
                WORKING_TIME = #{workingTime},
            </if>
            <if test="workoutTime != null">
                WORKOUT_TIME = #{workoutTime},
            </if>
        </set>
        WHERE MEMBER_NO = (SELECT MEMBER_NO FROM MEMBER WHERE MEMBER_ID = #{member.memberId})
    </update>

    <update id="updateWorkingBtnTime" parameterType="map">
        UPDATE ATTENDANCE
        SET WORKING_TIME = #{time}
        WHERE MEMBER_NO = (SELECT MEMBER_NO FROM MEMBER WHERE MEMBER_ID = #{memberId})
    </update>

    <update id="updateWorkLeaveBtnTime" parameterType="map">
        UPDATE ATTENDANCE
        SET WORKOUT_TIME = #{time}
        WHERE MEMBER_NO = (SELECT MEMBER_NO FROM MEMBER WHERE MEMBER_ID = #{memberId})
    </update>






</mapper>

